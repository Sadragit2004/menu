{% load humanize %}

<div class="w-full max-w-7xl mx-auto p-4">

    <!-- بنر افتتاح اولین منو -->
    <div id="firstTimeBanner" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm transform transition-all duration-500 scale-95 animate-in">
            <div class="p-6 text-center">
                <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-utensils text-white text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-3">منوی آنلاین خودت رو بساز!</h3>
                <p class="text-gray-600 mb-6 text-sm leading-relaxed">
                    با ساخت منوی دیجیتال، کسب و کارت رو متحول کن و سفارشاتت رو چند برابر افزایش بده
                </p>
                <div class="space-y-3">
                    <button onclick="startCreatingMenu()"
                            class="w-full bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-4 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg">
                        <i class="fas fa-rocket ml-2"></i>
                        شروع کن، رایگان!
                    </button>
                    <button onclick="closeFirstTimeBanner()"
                            class="w-full bg-gray-100 hover:bg-gray-200 text-gray-600 py-3 rounded-xl font-medium transition-colors">
                        بعداً می‌سازم
                    </button>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <div class="grid grid-cols-2 gap-3 text-xs text-gray-500">
                        <div class="flex items-center justify-center">
                            <i class="fas fa-bolt text-yellow-500 ml-1"></i>
                            <span>سریع و آسان</span>
                        </div>
                        <div class="flex items-center justify-center">
                            <i class="fas fa-qrcode text-blue-500 ml-1"></i>
                            <span>QR Code رایگان</span>
                        </div>
                        <div class="flex items-center justify-center">
                            <i class="fas fa-mobile text-purple-500 ml-1"></i>
                            <span>ریسپانسیو</span>
                        </div>
                        <div class="flex items-center justify-center">
                            <i class="fas fa-chart-line text-green-500 ml-1"></i>
                            <span>افزایش فروش</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- آمار کلی -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-6 shadow-lg hover-lift transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-blue-100 text-sm mb-2">کل سفارشات</p>
                    <h3 class="text-2xl font-bold">{{ all_orders|length|default:0 }}</h3>
                    <p class="text-blue-100 text-xs mt-2">همه انواع سفارشات</p>
                </div>
                <div class="w-14 h-14 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="fas fa-shopping-bag text-2xl"></i>
                </div>
            </div>
        </div>

        <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-6 shadow-lg hover-lift transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-green-100 text-sm mb-2">منوهای ساخته شده</p>
                    <h3 class="text-2xl font-bold">{{ restaurants.count|default:0 }}</h3>
                    <p class="text-green-100 text-xs mt-2">همه منوهای فعال</p>
                </div>
                <div class="w-14 h-14 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="fas fa-utensils text-2xl"></i>
                </div>
            </div>
        </div>

        <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl p-6 shadow-lg hover-lift transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-purple-100 text-sm mb-2">سفارشات امروز</p>
                    <h3 class="text-2xl font-bold">{{ today_orders|default:0 }}</h3>
                    <p class="text-purple-100 text-xs mt-2">24 ساعت گذشته</p>
                </div>
                <div class="w-14 h-14 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="fas fa-receipt text-2xl"></i>
                </div>
            </div>
        </div>

        <div class="bg-gradient-to-br from-orange-500 to-orange-600 text-white rounded-xl p-6 shadow-lg hover-lift transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-orange-100 text-sm mb-2">درآمد امروز</p>
                    <h3 class="text-2xl font-bold">{{ today_revenue|default:0|intcomma }}</h3>
                    <p class="text-orange-100 text-xs mt-2">تومان</p>
                </div>
                <div class="w-14 h-14 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="fas fa-wallet text-2xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- فیلترهای سفارشات -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 sm:p-6 mb-6">
    <div class="space-y-4 sm:space-y-0 sm:flex sm:items-center sm:justify-between">
        <div class="text-center sm:text-right">
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 flex items-center justify-center sm:justify-start">
                <i class="fas fa-filter text-blue-500 ml-2 sm:ml-3 text-base sm:text-lg"></i>
                فیلتر سفارشات
            </h2>
            <p class="text-gray-600 text-xs sm:text-sm mt-1 sm:mt-2">سفارشات خود را بر اساس نوع و وضعیت فیلتر کنید</p>
        </div>
    </div>

    <!-- فیلتر نوع سفارش -->
    <div class="mt-4 sm:mt-6">
        <h3 class="text-sm font-medium text-gray-700 mb-2">نوع سفارش</h3>
        <div class="grid grid-cols-2 sm:flex flex-wrap gap-2">
            <button onclick="filterOrdersByType('all')"
                    class="type-filter-btn active px-3 py-2 sm:px-4 sm:py-2.5 rounded-lg font-medium text-xs sm:text-sm transition-all duration-300 bg-blue-500 text-white shadow-md hover:shadow-lg flex items-center justify-center sm:justify-start">
                <i class="fas fa-layer-group ml-1 sm:ml-2 text-xs sm:text-sm"></i>
                <span class="truncate">همه</span>
            </button>

            <button onclick="filterOrdersByType('menu')"
                    class="type-filter-btn px-3 py-2 sm:px-4 sm:py-2.5 rounded-lg font-medium text-xs sm:text-sm transition-all duration-300 bg-green-500 text-white hover:shadow-lg flex items-center justify-center sm:justify-start">
                <i class="fas fa-utensils ml-1 sm:ml-2 text-xs sm:text-sm"></i>
                <span class="truncate">منو</span>
            </button>

            <button onclick="filterOrdersByType('plan')"
                    class="type-filter-btn px-3 py-2 sm:px-4 sm:py-2.5 rounded-lg font-medium text-xs sm:text-sm transition-all duration-300 bg-purple-500 text-white hover:shadow-lg flex items-center justify-center sm:justify-start">
                <i class="fas fa-crown ml-1 sm:ml-2 text-xs sm:text-sm"></i>
                <span class="truncate">پلن</span>
            </button>

            <button onclick="filterOrdersByType('product')"
                    class="type-filter-btn px-3 py-2 sm:px-4 sm:py-2.5 rounded-lg font-medium text-xs sm:text-sm transition-all duration-300 bg-orange-500 text-white hover:shadow-lg flex items-center justify-center sm:justify-start">
                <i class="fas fa-box ml-1 sm:ml-2 text-xs sm:text-sm"></i>
                <span class="truncate">محصول</span>
            </button>
        </div>
    </div>

    <!-- فیلتر وضعیت -->
    <div class="mt-4">
        <h3 class="text-sm font-medium text-gray-700 mb-2">وضعیت پرداخت</h3>
        <div class="grid grid-cols-3 sm:flex flex-wrap gap-2">
            <button onclick="filterOrdersByStatus('all')"
                    class="status-filter-btn active px-3 py-2 sm:px-4 sm:py-2.5 rounded-lg font-medium text-xs sm:text-sm transition-all duration-300 bg-gray-500 text-white shadow-md hover:shadow-lg flex items-center justify-center">
                همه
            </button>

            <button onclick="filterOrdersByStatus('unpaid')"
                    class="status-filter-btn px-3 py-2 sm:px-4 sm:py-2.5 rounded-lg font-medium text-xs sm:text-sm transition-all duration-300 bg-red-500 text-white hover:shadow-lg flex items-center justify-center sm:justify-start">
                <i class="fas fa-clock ml-1 sm:ml-2 text-xs sm:text-sm"></i>
                <span class="truncate">پرداخت نشده</span>
            </button>

            <button onclick="filterOrdersByStatus('paid')"
                    class="status-filter-btn px-3 py-2 sm:px-4 sm:py-2.5 rounded-lg font-medium text-xs sm:text-sm transition-all duration-300 bg-green-500 text-white hover:shadow-lg flex items-center justify-center sm:justify-start">
                <i class="fas fa-check-circle ml-1 sm:ml-2 text-xs sm:text-sm"></i>
                <span class="truncate">پرداخت شده</span>
            </button>
        </div>
    </div>
</div>

<style>
/* استایل‌های اضافی برای بهینه‌سازی بیشتر */
@media (max-width: 640px) {
    .type-filter-btn, .status-filter-btn {
        min-height: 36px;
    }

    .type-filter-btn span, .status-filter-btn span {
        font-size: 11px;
    }
}

/* استایل‌های فعال و غیرفعال */
.type-filter-btn.active,
.status-filter-btn.active {
    transform: scale(1.02);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
}

.type-filter-btn:not(.active):hover,
.status-filter-btn:not(.active):hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1) !important;
}
</style>

<script>
function filterOrdersByType(type) {
    // حذف کلاس active از همه دکمه‌های نوع
    document.querySelectorAll('.type-filter-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.classList.remove('shadow-lg');
    });

    // اضافه کردن کلاس active به دکمه کلیک شده
    event.target.classList.add('active');
    event.target.classList.add('shadow-lg');

    // کد فیلتر سفارشات بر اساس نوع
    console.log('فیلتر بر اساس نوع:', type);
    // TODO: پیاده‌سازی فیلتر واقعی
}

function filterOrdersByStatus(status) {
    // حذف کلاس active از همه دکمه‌های وضعیت
    document.querySelectorAll('.status-filter-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.classList.remove('shadow-lg');
    });

    // اضافه کردن کلاس active به دکمه کلیک شده
    event.target.classList.add('active');
    event.target.classList.add('shadow-lg');

    // کد فیلتر سفارشات بر اساس وضعیت
    console.log('فیلتر بر اساس وضعیت:', status);
    // TODO: پیاده‌سازی فیلتر واقعی
}
</script>

    <!-- بخش تمام سفارشات -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 mb-6">
        <div class="p-6 border-b border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 flex items-center">
                <i class="fas fa-shopping-bag text-blue-500 ml-3 text-lg"></i>
                تمام سفارشات من
            </h2>
            <p class="text-gray-600 text-sm mt-2">مدیریت تمام سفارشات شما در یک مکان</p>
        </div>

        <div class="p-6">
            {% if all_orders %}
            <div class="space-y-4" id="all-orders-container">
                {% for order_data in all_orders %}
                <div class="order-item border border-gray-200 rounded-xl p-5 hover:shadow-lg transition-all duration-300"
                     data-type="{{ order_data.type }}"
                     data-status="{{ order_data.status }}"
                     data-order-id="{{ order_data.object.id }}">

                    <!-- هدر سفارش -->
                    <div class="flex items-center justify-between mb-4 pb-4 border-b border-gray-100">
                        <div class="flex items-center space-x-4 space-x-reverse">
                            <!-- آیکون نوع سفارش -->
                            <div class="w-10 h-10 rounded-full flex items-center justify-center
                                {% if order_data.type == 'menu' %}bg-green-100 text-green-600
                                {% elif order_data.type == 'plan' %}bg-purple-100 text-purple-600
                                {% else %}bg-orange-100 text-orange-600{% endif %}">
                                <i class="fas
                                    {% if order_data.type == 'menu' %}fa-utensils
                                    {% elif order_data.type == 'plan' %}fa-crown
                                    {% else %}fa-box{% endif %}">
                                </i>
                            </div>

                            <div>
                                <h3 class="font-bold text-gray-800">
                                    {% if order_data.type == 'menu' %}
                                        سفارش منو: {{ order_data.object.restaurant.title }}
                                    {% elif order_data.type == 'plan' %}
                                        سفارش پلن: {{ order_data.object.plan.name }}
                                    {% else %}
                                        سفارش محصول
                                    {% endif %}
                                </h3>
                                <p class="text-gray-500 text-sm">
                                    <i class="fas fa-calendar ml-1"></i>
                                    {{ order_data.created_at|date:"Y/m/d - H:i" }}
                                </p>
                            </div>
                        </div>

                        <div class="flex items-center space-x-2 space-x-reverse">
                            <!-- وضعیت -->
                            <span class="status-badge px-3 py-1 rounded-lg text-sm font-medium
                                {% if order_data.is_paid %}bg-green-100 text-green-600 border border-green-200
                                {% else %}bg-red-100 text-red-600 border border-red-200{% endif %}">
                                <i class="fas {% if order_data.is_paid %}fa-check-circle{% else %}fa-clock{% endif %} ml-1 text-xs"></i>
                                {% if order_data.type == 'menu' %}
                                    {{ order_data.object.get_status_display }}
                                {% elif order_data.type == 'plan' %}
                                    {% if order_data.is_paid %}پرداخت شده{% else %}پرداخت نشده{% endif %}
                                {% else %}
                                    {{ order_data.object.get_status_display }}
                                {% endif %}
                            </span>

                            <!-- نوع سفارش -->
                            <span class="type-badge px-3 py-1 rounded-lg text-sm font-medium
                                {% if order_data.type == 'menu' %}bg-green-100 text-green-600 border border-green-200
                                {% elif order_data.type == 'plan' %}bg-purple-100 text-purple-600 border border-purple-200
                                {% else %}bg-orange-100 text-orange-600 border border-orange-200{% endif %}">
                                {% if order_data.type == 'menu' %}منو
                                {% elif order_data.type == 'plan' %}پلن
                                {% else %}محصول{% endif %}
                            </span>
                        </div>
                    </div>

                    <!-- اطلاعات سفارش -->
                    <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4">
                        <div class="flex-1">
                            <!-- اطلاعات خاص هر نوع -->
                            {% if order_data.type == 'menu' %}
                            <div class="mb-4">
                                <p class="text-gray-700 font-medium">{{ order_data.object.restaurant.title }}</p>
                                <p class="text-gray-500 text-sm mt-1">
                                    <i class="fas fa-link ml-1 text-gray-400"></i>
                                    آدرس: /menu/{{ order_data.object.restaurant.slug }}
                                </p>
                                {% if order_data.object.is_seo_enabled %}
                                <p class="text-purple-600 text-sm mt-1">
                                    <i class="fas fa-search ml-1"></i>
                                    سئو فعال
                                </p>
                                {% endif %}
                            </div>

                            {% elif order_data.type == 'plan' %}
                            <div class="mb-4">
                                <p class="text-gray-700 font-medium">{{ order_data.object.plan.name }}</p>
                                <p class="text-gray-500 text-sm mt-1">
                                    <i class="fas fa-calendar ml-1"></i>
                                    {% if order_data.object.expiryDate %}
                                        انقضا: {{ order_data.object.expiryDate|date:"Y/m/d" }}
                                        ({{ order_data.object.days_remaining }} روز باقی‌مانده)
                                    {% else %}
                                        تاریخ انقضا تنظیم نشده
                                    {% endif %}
                                </p>
                            </div>

                            {% else %}
                            <div class="mb-4">
                                <p class="text-gray-700 font-medium">سفارش محصول</p>
                                <p class="text-gray-500 text-sm mt-1">
                                    <i class="fas fa-cube ml-1"></i>
                                    {{ order_data.object.items.count }} آیتم
                                </p>
                                {% if order_data.object.order_info %}
                                <p class="text-gray-500 text-sm mt-1">
                                    <i class="fas fa-user ml-1"></i>
                                    {{ order_data.object.order_info.full_name }}
                                </p>
                                {% endif %}
                            </div>
                            {% endif %}

                            <!-- اطلاعات قیمت -->
                            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-600 text-sm">مبلغ سفارش</p>
                                        <p class="font-bold text-gray-800 text-lg">
                                            {{ order_data.final_price|intcomma }} تومان
                                        </p>
                                    </div>
                                    {% if not order_data.is_paid %}
                                    <button onclick="processPayment('{{ order_data.type }}', {{ order_data.object.id }})"
                                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                        <i class="fas fa-credit-card ml-2"></i>
                                        پرداخت
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- دکمه‌های اقدام -->
                        <!-- دکمه‌های اقدام -->
<div class="flex flex-col space-y-3 min-w-[200px]">
    {% if order_data.type == 'menu' %}
        <a href="{% url 'panel:menu_order_detail' order_data.object.id %}"
           class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-xl text-sm font-medium transition-all duration-300 flex items-center justify-center">
            <i class="fas fa-eye ml-2"></i>
            مشاهده جزئیات
        </a>
    {% elif order_data.type == 'plan' %}
        <a href="{% url 'panel:plan_order_detail' order_data.object.id %}"
           class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-xl text-sm font-medium transition-all duration-300 flex items-center justify-center">
            <i class="fas fa-eye ml-2"></i>
            مشاهده جزئیات
        </a>
    {% elif order_data.type == 'product' %}
        <a href="{% url 'panel:product_order_detail' order_data.object.id %}"
           class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-xl text-sm font-medium transition-all duration-300 flex items-center justify-center">
            <i class="fas fa-eye ml-2"></i>
            مشاهده جزئیات
        </a>
    {% endif %}

    {% if not order_data.is_paid %}
    <button onclick="cancelOrder('{{ order_data.type }}', {{ order_data.object.id }})"
            class="w-full border border-red-300 hover:bg-red-50 text-red-600 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-300 flex items-center justify-center">
        <i class="fas fa-times ml-2"></i>
        لغو سفارش
    </button>
    {% endif %}

    {% if order_data.type == 'plan' and order_data.is_paid %}
    <button onclick="extendPlan({{ order_data.object.id }})"
            class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-xl text-sm font-medium transition-all duration-300 flex items-center justify-center">
        <i class="fas fa-sync-alt ml-2"></i>
        تمدید پلن
    </button>
    {% endif %}
</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <!-- حالت خالی -->
            <div class="text-center py-12">
                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center text-gray-400 mx-auto mb-4">
                    <i class="fas fa-shopping-bag text-3xl"></i>
                </div>
                <h3 class="text-gray-500 text-lg font-medium mb-2">هنوز سفارشی ثبت نکرده‌اید</h3>
                <p class="text-gray-400 mb-6">سفارشات شما در این بخش نمایش داده می‌شوند</p>
                <div class="flex flex-col sm:flex-row gap-3 justify-center">
                    <button onclick="openCreateRestaurantModal()"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-medium transition-colors">
                        ساخت اولین منو
                    </button>
                    <a href="{% url 'plan:plan_list' %}"
                       class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-xl font-medium transition-colors">
                        مشاهده پلن‌ها
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- محتوای اصلی -->
    <div class="flex flex-col xl:flex-row gap-6">
        <!-- ستون سمت چپ -->
        <div class="xl:w-2/3 space-y-6">
            <!-- آمار ماهانه -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-chart-bar text-green-500 ml-2"></i>
                    آمار ماهانه
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center">
                        <p class="text-gray-600 text-sm">سفارشات این ماه</p>
                        <p class="text-2xl font-bold text-gray-800">{{ monthly_orders|default:0 }}</p>
                    </div>
                    <div class="text-center">
                        <p class="text-gray-600 text-sm">درآمد این ماه</p>
                        <p class="text-2xl font-bold text-green-600">{{ monthly_revenue|default:0|intcomma }}</p>
                        <p class="text-gray-500 text-xs">تومان</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ستون سمت راست -->
        <div class="xl:w-1/3 space-y-6">
            <!-- منوهای شما -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100">
                <div class="p-6 border-b border-gray-100">
                    <h2 class="text-xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-utensils text-blue-500 ml-3 text-lg"></i>
                        منوهای شما
                    </h2>
                </div>
                <div class="p-6">
                    {% if restaurants %}
                    <div class="space-y-4">
                        {% for restaurant in restaurants %}
                        <div class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-all duration-300">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-800 mb-2">{{ restaurant.title }}</h3>
                                    <p class="text-gray-500 text-sm mb-3 flex items-center">
                                        <i class="fas fa-link ml-1 text-gray-400"></i>
                                        /menu/{{ restaurant.slug }}
                                    </p>
                                    <div class="flex items-center space-x-2 space-x-reverse flex-wrap gap-2">
                                        <span class="bg-green-100 text-green-600 px-2 py-1 rounded text-xs font-medium">
                                            {{ restaurant.foods.count }} غذا
                                        </span>
                                        <span class="bg-blue-100 text-blue-600 px-2 py-1 rounded text-xs font-medium">
                                            {{ restaurant.categories.count }} دسته‌بندی
                                        </span>
                                    </div>
                                </div>
                                <div class="flex flex-col space-y-2 mr-4">
                                    <a href="{% url 'panel:restaurant_admin' slug=restaurant.slug %}"
                                       class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-xs text-center transition-colors whitespace-nowrap">
                                        مدیریت منو
                                    </a>
                                    <button onclick="copyMenuLink('{{ restaurant.slug }}')"
                                            class="bg-gray-100 hover:bg-gray-200 text-gray-600 px-4 py-2 rounded-lg text-xs transition-colors whitespace-nowrap">
                                        کپی لینک
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-8">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-gray-400 mx-auto mb-4">
                            <i class="fas fa-utensils text-2xl"></i>
                        </div>
                        <p class="text-gray-500 mb-4">هنوز منویی نساخته‌اید</p>
                        <button onclick="openCreateRestaurantModal()"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-medium transition-colors">
                            ساخت اولین منو
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- نکات و پیشنهادات -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-100 border border-blue-200 rounded-2xl p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-lightbulb text-yellow-500 ml-2"></i>
                    راهنمای افزایش فروش
                </h3>
                <div class="space-y-3">
                    <div class="flex items-start space-x-3 space-x-reverse">
                        <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                            <i class="fas fa-qrcode text-white text-xs"></i>
                        </div>
                        <p class="text-sm text-gray-700">
                            <strong>QR Code روی میزها:</strong> برای افزایش ۳ برابری سفارشات
                        </p>
                    </div>
                    <div class="flex items-start space-x-3 space-x-reverse">
                        <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                            <i class="fas fa-image text-white text-xs"></i>
                        </div>
                        <p class="text-sm text-gray-700">
                            <strong>عکس‌های باکیفیت:</strong> ۶۰٪ افزایش جذابیت منو
                        </p>
                    </div>
                    <div class="flex items-start space-x-3 space-x-reverse">
                        <div class="w-6 h-6 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                            <i class="fas fa-bolt text-white text-xs"></i>
                        </div>
                        <p class="text-sm text-gray-700">
                            <strong>توضیحات صوتی:</strong> تجربه متفاوت برای مشتریان
                        </p>
                    </div>
                </div>
                <div class="mt-6 pt-4 border-t border-blue-200">
                    <a href="#" class="text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center">
                        راهنمای کامل استفاده
                        <i class="fas fa-arrow-left mr-2"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- مودال نمایش عکس -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-90 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="relative w-full max-w-4xl">
            <button onclick="closeImageModal()"
                    class="absolute -top-12 left-0 text-white text-2xl hover:text-gray-300 transition-colors">
                <i class="fas fa-times"></i>
            </button>
            <img id="modalImage" src="" alt="عکس منو" class="w-full h-auto rounded-lg">
        </div>
    </div>
</div>

<script>
// فیلتر کردن بر اساس نوع سفارش
function filterOrdersByType(type) {
    const orderItems = document.querySelectorAll('.order-item');
    const typeButtons = document.querySelectorAll('.type-filter-btn');

    typeButtons.forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');

    orderItems.forEach(item => {
        const itemType = item.getAttribute('data-type');
        if (type === 'all' || itemType === type) {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
}

// فیلتر کردن بر اساس وضعیت
function filterOrdersByStatus(status) {
    const orderItems = document.querySelectorAll('.order-item');
    const statusButtons = document.querySelectorAll('.status-filter-btn');

    statusButtons.forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');

    orderItems.forEach(item => {
        const itemStatus = item.getAttribute('data-status');
        const isPaid = itemStatus === '2' || itemStatus === '3' || itemStatus === '4' || itemStatus === 'paid';

        if (status === 'all' ||
            (status === 'unpaid' && !isPaid) ||
            (status === 'paid' && isPaid)) {
            if (item.style.display !== 'none') {
                item.style.display = 'block';
            }
        } else {
            item.style.display = 'none';
        }
    });
}

// پرداخت سفارش
function processPayment(orderType, orderId) {
    if (confirm('آیا می‌خواهید به درگاه پرداخت منتقل شوید؟')) {
        showNotification('در حال انتقال به درگاه پرداخت...', 'info');

        if (orderType === 'menu') {
            window.location.href = `/peyment/request/menu/${orderId}/`;
        } else if (orderType === 'plan') {
            window.location.href = `/peyment/request/plan/${orderId}/`;
        } else if (orderType === 'product') {
            window.location.href = `/peyment/request/product/${orderId}/`;
        }
    }
}

// لغو سفارش
function cancelOrder(orderType, orderId) {
    if (confirm('آیا از لغو این سفارش مطمئن هستید؟')) {
        fetch(`/panel/${orderType}/${orderId}/cancel/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('سفارش با موفقیت لغو شد ✅');
                setTimeout(() => {
                    location.reload();
                }, 1500);
            } else {
                showNotification('خطا در لغو سفارش: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('خطا در ارتباط با سرور ❌', 'error');
        });
    }
}

// تمدید پلن
function extendPlan(planOrderId) {
    if (confirm('آیا می‌خواهید این پلن را تمدید کنید؟')) {
        showNotification('در حال انتقال به صفحه تمدید...', 'info');
        window.location.href = `/plan/renew/${planOrderId}/`;
    }
}

// مشاهده عکس در مودال
function viewImage(imageUrl) {
    document.getElementById('modalImage').src = imageUrl;
    document.getElementById('imageModal').classList.remove('hidden');
}

function closeImageModal() {
    document.getElementById('imageModal').classList.add('hidden');
}

// کپی لینک منو
function copyMenuLink(slug) {
    const link = `${window.location.origin}/menu/${slug}`;
    navigator.clipboard.writeText(link).then(() => {
        showNotification('لینک منو در کلیپ‌بورد کپی شد ✅');
    });
}

// نمایش نوتیفیکیشن
function showNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = `fixed top-6 left-1/2 transform -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg text-white font-medium ${
        type === 'success' ? 'bg-green-500' :
        type === 'error' ? 'bg-red-500' :
        'bg-blue-500'
    } animate-bounce`;
    notification.textContent = message;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// مدیریت بنر
function checkFirstTimeVisit() {
    const hasRestaurants = {{ restaurants.count|default:0 }} > 0;
    if (hasRestaurants) {
        return;
    }

    setTimeout(() => {
        const banner = document.getElementById('firstTimeBanner');
        banner.classList.remove('hidden');
        setTimeout(() => {
            banner.querySelector('.animate-in').classList.remove('scale-95');
        }, 100);
    }, 2000);
}

function startCreatingMenu() {
    closeFirstTimeBanner();
    openCreateRestaurantModal();
}

function closeFirstTimeBanner() {
    const banner = document.getElementById('firstTimeBanner');
    banner.querySelector('.animate-in').classList.add('scale-95');
    setTimeout(() => {
        banner.classList.add('hidden');
    }, 300);
}

// مقداردهی اولیه
document.addEventListener('DOMContentLoaded', function() {
    checkFirstTimeVisit();
    filterOrdersByType('all');
    filterOrdersByStatus('all');
});

// مدیریت کلیک خارج از بنر و مودال
document.getElementById('firstTimeBanner').addEventListener('click', function(e) {
    if (e.target === this) {
        closeFirstTimeBanner();
    }
});

document.getElementById('imageModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeImageModal();
    }
});

// بستن با دکمه ESC
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const banner = document.getElementById('firstTimeBanner');
        if (!banner.classList.contains('hidden')) {
            closeFirstTimeBanner();
        }
        const imageModal = document.getElementById('imageModal');
        if (!imageModal.classList.contains('hidden')) {
            closeImageModal();
        }
    }
});
</script>

<style>
.hover-lift:hover {
    transform: translateY(-4px);
    transition: transform 0.3s ease;
}

.animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.7;
    }
}

.animate-bounce {
    animation: bounce 0.5s;
}

@keyframes bounce {
    0%, 20%, 53%, 80%, 100% {
        transform: translate3d(-50%, 0, 0);
    }
    40%, 43% {
        transform: translate3d(-50%, -15px, 0);
    }
    70% {
        transform: translate3d(-50%, -10px, 0);
    }
    90% {
        transform: translate3d(-50%, -5px, 0);
    }
}

.animate-in {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.animate-in {
    animation: slideInUp 0.5s ease-out;
}

.type-filter-btn, .status-filter-btn {
    @apply flex items-center transition-all duration-300 transform hover:scale-105;
}

.type-filter-btn.active, .status-filter-btn.active {
    @apply shadow-lg scale-105;
}

.status-badge, .type-badge {
    display: inline-flex;
    align-items: center;
    transition: all 0.3s ease;
}

.status-badge:hover, .type-badge:hover {
    transform: scale(1.05);
}

.order-item {
    transition: all 0.3s ease;
}

.order-item:hover {
    transform: translateY(-2px);
}

@media (max-width: 380px) {
    #firstTimeBanner .max-w-sm {
        max-width: 95vw;
        margin: 0 auto;
    }
}

body:has(#firstTimeBanner:not(.hidden)) {
    overflow: hidden;
}

@media (max-width: 768px) {
    .container {
        padding-left: 1rem;
        padding-right: 1rem;
    }

    .type-filter-btn, .status-filter-btn {
        @apply text-sm px-3 py-2;
    }
}

@media (min-width: 1536px) {
    .container {
        max-width: 1280px;
    }
}
</style>