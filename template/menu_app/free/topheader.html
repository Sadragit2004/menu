<div class="restaurant-top-bar" style="background: #fff; padding: 10px 0; margin-bottom: 15px; position: relative; z-index: 10; overflow: hidden;">

    <!-- >>>>> Ø¨Ø®Ø´ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) <<<<< -->
    {% if restaurant.coverImage %}
        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;
                    background-image: url('{{ restaurant.coverImage.url }}');
                    background-size: cover;
                    background-position: center;
                    filter: blur(1px);
                    opacity: 0.85;
                    transform: scale(1.1);">
        </div>

        <div style="position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; z-index: 2;
                    background: linear-gradient(to bottom, rgba(255,255,255,0.1) 0%, #fff 100%);">
        </div>
    {% endif %}
    <!-- >>>>> Ù¾Ø§ÛŒØ§Ù† Ø¨Ø®Ø´ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ <<<<< -->

    <div class="top-bar-content" style="max-width: 1200px; margin: 0 auto; padding: 0 15px; display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 20;">

        <!-- Ø¨Ø®Ø´ Ø±Ø§Ø³Øª: Ø¢ÛŒÚ©ÙˆÙ† Ø³ÛŒÚ¯Ø§Ø± + Ø³Ø§Ø¹Øª Ú©Ø§Ø±ÛŒ -->
        <div style="flex: 1; display: flex; align-items: center; justify-content: flex-start; gap: 10px;">

            {% if restaurant.freeSmoke %}
                <div id="cigarette-icon" class="smoke-allowed"
                     data-status="allowed"
                     title="Smoking Allowed">
                    ğŸš¬
                </div>
            {% else %}
                <div id="cigarette-icon" class="smoke-forbidden"
                     data-status="forbidden"
                     title="No Smoking">
                    ğŸš­
                </div>
            {% endif %}

            <div style="font-size: 11px; color: #28a745; font-weight: 600; white-space: nowrap;">
                {% if restaurant.openingTime and restaurant.closingTime %}
                    {{ restaurant.openingTime|time:"H:i" }} - {{ restaurant.closingTime|time:"H:i" }}
                {% else %}
                    Open
                {% endif %}
            </div>
        </div>

        <!-- Ø¨Ø®Ø´ ÙˆØ³Ø·: Ø¢Ø¯Ø±Ø³ - Ù„ÙˆÚ¯Ùˆ - Ø¹Ù†ÙˆØ§Ù† -->
        <div style="flex: 0 0 auto; display: flex; flex-direction: column; align-items: center; text-align: center; position: relative; z-index: 21;">

            <!-- >>>>> ØªØºÛŒÛŒØ± ÙÙ‚Ø· Ø¯Ø± Ø§ÛŒÙ† Ø®Ø· (Ø§Ø³ØªØ§ÛŒÙ„ Ø¢Ø¯Ø±Ø³) <<<<< -->
            <div class="top-info address" style="font-size: 10px; color: #0066cc; margin-bottom: 5px; max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 600; background: rgba(255, 255, 255, 0.9); padding: 3px 8px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); backdrop-filter: blur(2px);">
                ğŸ“ {{ restaurant.address|default:"Location"|truncatechars:30 }}
            </div>
            <!-- >>>>> Ù¾Ø§ÛŒØ§Ù† ØªØºÛŒÛŒØ± <<<<< -->

            <div id="smoke-target" style="width: 48px; height: 48px; border-radius: 12px; margin: 0 auto 5px; overflow: hidden; background: linear-gradient(135deg, #3b82f6, #1d4ed8); display: flex; align-items: center; justify-content: center; color: white; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);">
                {% if restaurant.logo %}
                    <img src="{{ restaurant.logo.url }}" style="width:100%; height:100%; object-fit: cover;">
                {% else %}
                    <span style="font-weight: bold; font-size: 18px;">{{ restaurant.title|first|upper }}</span>
                {% endif %}
            </div>

            <h3 style="margin: 0; font-size: 12px; font-weight: 600; color: #333;">
                {{ restaurant.title_en|default:restaurant.title }}
            </h3>
        </div>

        <!-- Ø¨Ø®Ø´ Ú†Ù¾: Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
        <div style="flex: 1; display: flex; justify-content: flex-end; align-items: center; gap: 8px;">
            <a href="{% url 'menu:change_language' restaurant.slug %}?lang=en" style="background: #f3f4f6; color: #374151; width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; text-decoration: none; position: relative; z-index: 22;">
                EN
            </a>
            <button id="theme-toggle" style="background: #f3f4f6; width: 36px; height: 36px; border-radius: 8px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; position: relative; z-index: 22;">
                ğŸŒ™
            </button>
        </div>

    </div>

    <!-- Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø°Ø±Ø§Øª Ø¯ÙˆØ¯ -->
    <div id="smoke-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; overflow: hidden;"></div>
</div>

<style>
    /* Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ø®ØµÙˆØµ Ø­Ø§Ù„Øª Ø¢Ø²Ø§Ø¯ (Ø³Ø¨Ø² Ùˆ Ú©ÙˆÚ†Ú©) */
    .smoke-allowed {
        cursor: pointer;
        position: relative;
        z-index: 22;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1.5px solid #22c55e;
        background-color: rgba(240, 253, 244, 0.9);
        border-radius: 50%;
        font-size: 16px;
        transition: transform 0.2s;
    }

    /* Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ø®ØµÙˆØµ Ø­Ø§Ù„Øª Ù…Ù…Ù†ÙˆØ¹ (Ù‚Ø±Ù…Ø²) */
    .smoke-forbidden {
        cursor: default;
        position: relative;
        z-index: 22;
        font-size: 24px;
        color: #dc3545;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 50%;
        width: 32px;
        height: 32px;
    }

    /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ¯ */
    .smoke-particle {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(200,200,200,0.8) 0%, rgba(180,180,180,0.3) 50%, transparent 80%);
        filter: blur(5px);
        opacity: 0;
        transform-origin: center center;
        animation: smokeMove var(--duration) ease-out forwards;
    }

    @keyframes smokeMove {
        0% { transform: translate(0, 0) scale(0.5) rotate(0deg); opacity: 0.2; }
        20% { opacity: 0.6; transform: translate(calc(var(--move-x) * 0.2), calc(var(--move-y) * 0.2 - 10px)) scale(1.5); }
        100% { opacity: 0; transform: translate(calc(var(--move-x) + var(--spread-x)), calc(var(--move-y) - 30px)) scale(4) rotate(100deg); }
    }

    @keyframes puffScale {
        0% { transform: scale(1); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
    }

    /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù„Ø±Ø²Ø´ (Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª Ù…Ù…Ù†ÙˆØ¹) */
    @keyframes shakeNo {
        0%, 100% { transform: translateX(0); }
        20% { transform: translateX(-4px); }
        40% { transform: translateX(4px); }
        60% { transform: translateX(-4px); }
        80% { transform: translateX(4px); }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('smoke-container');
        const cigarette = document.getElementById('cigarette-icon');
        const target = document.getElementById('smoke-target');
        const themeToggle = document.getElementById('theme-toggle');

        const isSmokeAllowed = cigarette && cigarette.getAttribute('data-status') === 'allowed';

        function createParticle() {
            if (!container || !cigarette || !target || !isSmokeAllowed) return;

            const contRect = container.getBoundingClientRect();
            const cigRect = cigarette.getBoundingClientRect();
            const targetRect = target.getBoundingClientRect();

            const startX = (cigRect.left + cigRect.width / 2) - contRect.left;
            const startY = (cigRect.top + cigRect.height / 2) - contRect.top;
            const endX = (targetRect.left + targetRect.width / 2) - contRect.left;
            const endY = (targetRect.top + targetRect.height / 2) - contRect.top;

            const div = document.createElement('div');
            div.classList.add('smoke-particle');

            const size = 10 + Math.random() * 20;
            const duration = 2 + Math.random();
            const spreadX = (Math.random() - 0.5) * 50;

            div.style.width = size + 'px';
            div.style.height = size + 'px';
            div.style.left = (startX - size / 2) + 'px';
            div.style.top = (startY - size / 2) + 'px';

            div.style.setProperty('--move-x', (endX - startX) + 'px');
            div.style.setProperty('--move-y', (endY - startY) + 'px');
            div.style.setProperty('--spread-x', spreadX + 'px');
            div.style.setProperty('--duration', duration + 's');

            container.appendChild(div);
            setTimeout(() => { div.remove(); }, duration * 1000);
        }

        function puffSmoke() {
            if(!cigarette) return;

            if (isSmokeAllowed) {
                cigarette.style.animation = 'puffScale 0.3s ease';
                setTimeout(() => cigarette.style.animation = '', 300);

                let particles = 0;
                const interval = setInterval(() => {
                    createParticle();
                    particles++;
                    if (particles > 6) clearInterval(interval);
                }, 50);
            } else {
                cigarette.style.animation = 'shakeNo 0.4s ease';
                setTimeout(() => cigarette.style.animation = '', 400);
            }
        }

        if (isSmokeAllowed) {
            setTimeout(puffSmoke, 1000);
            setInterval(puffSmoke, 3500);
        }

        if(cigarette) cigarette.addEventListener('click', puffSmoke);

        if(themeToggle && isSmokeAllowed) {
            themeToggle.addEventListener('click', puffSmoke);
        }
    });
</script>
