<!-- این رپر با مارجین منفی، از کادر کانتینر والد بیرون می‌زند -->
<div class="header-categories-wrapper relative -mx-4">
    <!-- کانتینر اسکرول با پدینگ داخلی -->
    <div class="categories-scroll no-scrollbar px-4">
        <!-- 1. دکمه همه (All) -->
        <div class="category-item category-active" data-category="all">
            <div class="category-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            </div>
            <span class="category-name">همه</span>
        </div>

        <!-- 2. حلقه دسته‌بندی‌ها -->
        {% for menu_category in menu_categories %}
        <div class="category-item" data-category="{{ menu_category.id }}">
            {% if menu_category.displayImage %}
                <img loading="lazy" src="{{ menu_category.displayImage.url }}" alt="{{ menu_category.category.title }}" class="category-icon object-cover">
            {% else %}
                <div class="category-icon default-icon-bg">
                    <span style="font-size: 10px; font-weight: bold;">{{ menu_category.category.title|slice:":2" }}</span>
                </div>
            {% endif %}
            <span class="category-name">{{ menu_category.category.title }}</span>
        </div>
        {% endfor %}

        <!-- فضای خالی انتهایی -->
        <div style="min-width: 10px;"></div>
    </div>
</div>

<style>
    /* --- کانتینر اصلی --- */
    .categories-wrapper {
        position: relative;
        width: 100vw; /* عرض کل صفحه */
        left: 50%;
        right: 50%;
        margin-left: -50vw; /* ترفند وسط‌چین کردن تمام عرض */
        margin-right: -50vw;
        overflow: hidden;
    }

    .categories-scroll {
        display: flex;
        align-items: flex-start;
        gap: 12px; /* فاصله بین آیتم‌ها کمی کمتر شد تا تراکم بیشتر شود */
        overflow-x: auto;
        padding-bottom: 10px;
        padding-top: 5px;
        /* پدینگ چپ و راست برای اینکه آیتم اول و آخر به لبه نچسبند */
        padding-left: 16px;
        padding-right: 16px;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
    }

    /* مخفی کردن اسکرول‌بار */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* --- استایل آیتم‌ها --- */
    .category-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        cursor: pointer;
        /* عرض ثابت و کم برای اینکه تعداد بیشتری جا شوند و یکی نصفه بماند */
        min-width: 64px;
        max-width: 72px;
        flex-shrink: 0; /* جلوگیری از جمع شدن آیتم‌ها */
        transition: all 0.2s ease;
        -webkit-tap-highlight-color: transparent;
    }

    .category-icon {
        width: 50px; /* کمی کوچکتر برای ظرافت */
        height: 50px;
        border-radius: 16px;
        background-color: #f3f4f6;
        color: #6b7280;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 6px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        border: 2px solid transparent;
        overflow: hidden;
    }

    .category-name {
        font-size: 11px;
        color: #4b5563;
        text-align: center;
        line-height: 1.3;
        font-weight: 500;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        width: 100%;
        white-space: normal;
    }

    /* --- حالت Active --- */
    .category-item.category-active .category-icon {
        background-color: #fff;
        border-color: #3b82f6;
        color: #3b82f6;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
    }
    .category-item.category-active .category-name {
        color: #1d4ed8;
        font-weight: 700;
    }

    .default-icon-bg { background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%); }

    /* مد تاریک */
    @media (prefers-color-scheme: dark) {
        .category-name { color: #9ca3af; }
        .category-icon { background-color: #1f2937; color: #9ca3af; }
        .category-item.category-active .category-icon { background-color: #1f2937; border-color: #60a5fa; color: #60a5fa; }
        .category-item.category-active .category-name { color: #60a5fa; }
    }
</style>

<script>
    function filterCategory(id, element) {
        document.querySelectorAll('.category-item').forEach(el => el.classList.remove('category-active'));
        element.classList.add('category-active');
        // اسکرول اتوماتیک برای اینکه آیتم انتخاب شده بیاد وسط (اختیاری)
        element.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        console.log('Category selected:', id);
    }
</script>
