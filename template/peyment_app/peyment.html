<!-- templates/peyment_app/peyment.html -->
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پرداخت موفق - {{ title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Vazirmatn', sans-serif;
        }

        /* استایل دسکتاپ */
        @media (min-width: 768px) {
            .desktop-container {
                width: 500px;
                margin: 0 auto;
            }
            .desktop-card {
                padding: 40px;
            }
            .desktop-title {
                font-size: 1.75rem;
            }
            .desktop-message {
                font-size: 1.1rem;
            }
        }

        /* استایل موبایل */
        @media (max-width: 767px) {
            .mobile-container {
                width: 100%;
                padding: 16px;
            }
            .mobile-card {
                padding: 24px;
            }
            .mobile-title {
                font-size: 1.25rem;
            }
            .mobile-message {
                font-size: 0.95rem;
            }
        }

        .success-icon {
            width: 72px;
            height: 72px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .tracking-code {
            font-family: 'Courier New', Courier, monospace;
            letter-spacing: 1px;
        }

        .border-gradient {
            border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(135deg, #10b981 0%, #059669 100%) border-box;
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .timer-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">

    <!-- تایمر بازگشت خودکار -->
    <div id="timer-badge" class="fixed top-4 left-4 bg-white shadow-lg rounded-lg px-4 py-2 z-50 hidden md:flex items-center">
        <div class="w-2 h-2 bg-green-500 rounded-full ml-2 animate-pulse"></div>
        <span class="text-gray-700 text-sm">
            بازگشت به پنل در <span id="countdown" class="font-bold text-green-600">8</span> ثانیه
        </span>
    </div>

    <!-- کارت اصلی -->
    <div class="desktop-container mobile-container">
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border-gradient">

            <!-- هدر -->
            <div class="border-b border-gray-100 py-6 px-6 text-center">
                <div class="flex flex-col items-center">
                    <!-- لوگو سایت -->
                    <div class="mb-4">
                        <div class="success-icon rounded-full flex items-center justify-center mx-auto shadow">
                            <i class="fas fa-check text-white text-2xl"></i>
                        </div>
                    </div>

                    <h1 class="desktop-title mobile-title font-bold text-gray-800 mb-2">
                        پرداخت موفقیت‌آمیز
                    </h1>
                    <p class="text-gray-600 text-sm">
                        تراکنش شما با موفقیت انجام شد
                    </p>
                </div>
            </div>

            <!-- محتوای اصلی -->
            <div class="desktop-card mobile-card">

                <!-- پیام تبریک -->
                <div class="mb-8 text-center">
                    <p class="desktop-message mobile-message text-gray-700 mb-6">
                        سپاس از خرید شما. سفارش شما با موفقیت ثبت شد.
                    </p>

                    <!-- کد رهگیری -->
                    <div class="mb-8">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-gray-700 font-medium text-sm flex items-center">
                                <i class="fas fa-hashtag text-blue-500 ml-2"></i>
                                کد رهگیری:
                            </span>
                            <button onclick="copyToClipboard()"
                                    class="text-blue-600 hover:text-blue-800 text-xs flex items-center transition-colors">
                                <i class="fas fa-copy ml-1"></i>
                                کپی
                            </button>
                        </div>

                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                            <div class="tracking-code font-bold text-xl text-center text-gray-800 py-2" id="tracking-number">
                                {% if 'کد رهگیری:' in message %}
                                    {% with message|slice:"-11:" as code %}
                                        {{ code|cut:"کد رهگیری: "|cut:" " }}
                                    {% endwith %}
                                {% else %}
                                    {{ message }}
                                {% endif %}
                            </div>
                            <p class="text-gray-500 text-xs text-center mt-2">
                                این کد برای پیگیری سفارش شما ضروری است
                            </p>
                        </div>
                    </div>

                    <!-- اطلاعات تراکنش -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex items-center justify-between py-2">
                                <span class="text-gray-600 text-sm">
                                    <i class="fas fa-calendar ml-2"></i>
                                    تاریخ:
                                </span>
                                <span class="text-gray-800 font-medium text-sm" id="current-date"></span>
                            </div>
                            <div class="flex items-center justify-between py-2">
                                <span class="text-gray-600 text-sm">
                                    <i class="fas fa-clock ml-2"></i>
                                    زمان:
                                </span>
                                <span class="text-gray-800 font-medium text-sm" id="current-time"></span>
                            </div>
                            <div class="flex items-center justify-between py-2">
                                <span class="text-gray-600 text-sm">
                                    <i class="fas fa-check-circle ml-2"></i>
                                    وضعیت:
                                </span>
                                <span class="bg-green-100 text-green-800 text-xs font-medium px-3 py-1 rounded-full">
                                    موفق
                                </span>
                            </div>
                            <div class="flex items-center justify-between py-2">
                                <span class="text-gray-600 text-sm">
                                    <i class="fas fa-credit-card ml-2"></i>
                                    درگاه:
                                </span>
                                <span class="text-gray-800 font-medium text-sm">زرین‌پال</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- پیام توضیحی -->
                <div class="mb-8">
                    <div class="bg-blue-50 border border-blue-100 rounded-lg p-4">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-blue-500 mt-0.5 ml-3"></i>
                            <div>
                                <h4 class="font-medium text-blue-800 mb-2 text-sm">اطلاعات تکمیلی</h4>
                                <ul class="text-blue-700 text-sm space-y-1">
                                    <li class="flex items-start">
                                        <i class="fas fa-chevron-left text-blue-400 mt-1 ml-2 text-xs"></i>
                                        <span>رسید پرداخت به ایمیل شما ارسال خواهد شد</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-chevron-left text-blue-400 mt-1 ml-2 text-xs"></i>
                                        <span>برای پیگیری سفارش از کد رهگیری استفاده کنید</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-chevron-left text-blue-400 mt-1 ml-2 text-xs"></i>
                                        <span>در صورت نیاز به پشتیبانی، کد رهگیری را ارائه دهید</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- دکمه‌های اقدام -->
                <div class="space-y-4">
                    <!-- دکمه اصلی -->
                    <a href="{% url 'panel:panel' %}"
                       class="btn-primary text-white font-medium py-3.5 px-4 rounded-lg w-full flex items-center justify-center">
                        <i class="fas fa-tachometer-alt ml-2"></i>
                        بازگشت به پنل کاربری
                    </a>

                    <!-- دکمه‌های فرعی -->
                    <div class="grid grid-cols-2 gap-3">
                        <a href="#" onclick="window.print()"
                           class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700
                                  font-medium py-3 px-3 rounded-lg flex items-center justify-center text-sm">
                            <i class="fas fa-print ml-1.5"></i>
                            چاپ رسید
                        </a>
                        <a href="#" onclick="downloadReceipt()"
                           class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700
                                  font-medium py-3 px-3 rounded-lg flex items-center justify-center text-sm">
                            <i class="fas fa-download ml-1.5"></i>
                            ذخیره PDF
                        </a>
                    </div>
                </div>

                <!-- تایمر موبایل -->
                <div id="mobile-timer" class="mt-6 text-center md:hidden">
                    <div class="inline-flex items-center bg-gray-100 rounded-full px-4 py-2">
                        <div class="w-2 h-2 bg-green-500 rounded-full ml-2 animate-pulse"></div>
                        <span class="text-gray-600 text-xs">
                            بازگشت خودکار در <span id="mobile-countdown" class="font-bold text-green-600">8</span> ثانیه
                        </span>
                    </div>
                </div>
            </div>

            <!-- فوتر -->
            <div class="border-t border-gray-100 py-4 px-6 bg-gray-50">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="flex items-center text-gray-600 text-xs mb-2 md:mb-0">
                        <i class="fas fa-shield-alt ml-2"></i>
                        <span>پرداخت امن با گواهی SSL</span>
                    </div>
                    <div class="flex items-center text-gray-600 text-xs">
                        <i class="fas fa-headset ml-2"></i>
                        <span>پشتیبانی: ۰۲۱-۱۲۳۴۵۶۷۸</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- لوگو و اطلاعات درگاه -->
        <div class="mt-6 text-center">
            <div class="flex flex-col md:flex-row items-center justify-center gap-4">
                <div class="flex items-center text-gray-600 text-sm bg-white/80 backdrop-blur-sm rounded-lg px-4 py-2">
                    <img src="https://www.zarinpal.com/assets/images/logo/zarinpal-logo.svg"
                         alt="ZarinPal" class="h-5 ml-2">
                    <span>درگاه پرداخت امن زرین‌پال</span>
                </div>
                <div class="text-gray-500 text-xs">
                    <i class="fas fa-check-circle text-green-500 ml-1"></i>
                    این تراکنش توسط بانک مرکزی تأیید شده است
                </div>
            </div>
        </div>
    </div>

    <script>
        // تنظیم تاریخ و زمان فارسی
        function updatePersianDateTime() {
            const now = new Date();
            const dateFormatter = new Intl.DateTimeFormat('fa-IR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const timeFormatter = new Intl.DateTimeFormat('fa-IR', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });

            document.getElementById('current-date').textContent = dateFormatter.format(now);
            document.getElementById('current-time').textContent = timeFormatter.format(now);
        }

        // تایمر بازگشت خودکار
        let countdown = 8;
        let redirectTimer;

        function startRedirectTimer() {
            const desktopTimer = document.getElementById('countdown');
            const mobileTimer = document.getElementById('mobile-countdown');

            redirectTimer = setInterval(() => {
                countdown--;
                if (desktopTimer) desktopTimer.textContent = countdown;
                if (mobileTimer) mobileTimer.textContent = countdown;

                if (countdown <= 0) {
                    clearInterval(redirectTimer);
                    window.location.href = "{% url 'panel:panel' %}";
                }
            }, 1000);
        }

        // کپی کد رهگیری
        function copyToClipboard() {
            const trackingNumber = document.getElementById('tracking-number').textContent.trim();
            navigator.clipboard.writeText(trackingNumber).then(() => {
                // نمایش اعلان موفقیت
                showNotification('کد رهگیری با موفقیت کپی شد');
            }).catch(err => {
                console.error('خطا در کپی کردن: ', err);
            });
        }

        // شبیه‌سازی دانلود رسید
        function downloadReceipt() {
            const button = document.querySelector('a[onclick="downloadReceipt()"]');
            const originalText = button.innerHTML;

            button.innerHTML = '<i class="fas fa-spinner fa-spin ml-1.5"></i> در حال آماده‌سازی';
            button.disabled = true;

            setTimeout(() => {
                button.innerHTML = '<i class="fas fa-check ml-1.5"></i> دانلود شد';
                button.classList.add('text-green-600', 'border-green-300');

                showNotification('فایل PDF رسید آماده شد');

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('text-green-600', 'border-green-300');
                    button.disabled = false;
                }, 2000);
            }, 1500);
        }

        // نمایش نوتیفیکیشن
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 ' +
                                    'bg-green-500 text-white p-4 rounded-lg shadow-lg z-50 animate__animated animate__fadeInUp';
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-xl ml-3"></i>
                        <span class="text-sm">${message}</span>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()"
                            class="text-white/70 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('animate__fadeOutDown');
                    setTimeout(() => notification.remove(), 300);
                }
            }, 3000);
        }

        // استخراج کد رهگیری از پیام
        function extractTrackingCode() {
            const message = "{{ message|safe }}";
            if (message.includes('کد رهگیری:')) {
                // حذف کاراکترهای غیر عددی
                const numbers = message.replace(/\D/g, '');
                // 11 رقم آخر را بگیر (برای کد رهگیری زرین‌پال)
                const trackingCode = numbers.slice(-11);
                if (trackingCode.length === 11) {
                    document.getElementById('tracking-number').textContent = trackingCode;
                }
            }
        }

        // شروع تایمر
        startRedirectTimer();

        // نمایش تایمر دسکتاپ
        setTimeout(() => {
            document.getElementById('timer-badge').style.display = 'flex';
        }, 500);

        // بروزرسانی تاریخ و زمان
        updatePersianDateTime();
        setInterval(updatePersianDateTime, 60000); // هر دقیقه

        // استخراج کد رهگیری
        extractTrackingCode();

        // نمایش پیام کامل در کنسول برای دیباگ
        console.log("پیام کامل:", "{{ message|safe }}");
    </script>

    <!-- کتابخانه انیمیشن -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
</body>
</html>